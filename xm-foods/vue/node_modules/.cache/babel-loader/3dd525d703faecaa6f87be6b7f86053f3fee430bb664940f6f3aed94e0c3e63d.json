{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport Footer from \"@/components/Footer\";\nexport default {\n  name: \"FoodDetail\",\n  components: {\n    Footer\n  },\n  data() {\n    return {\n      id: this.$route.query.id,\n      // 菜谱ID\n      foods: {},\n      materialList: [],\n      stepList: [],\n      user: JSON.parse(localStorage.getItem('xm-user') || '{}'),\n      commentCount: 0,\n      content: '',\n      commentList: []\n    };\n  },\n  created() {\n    this.updateCount();\n    this.loadComment();\n  },\n  methods: {\n    handleShowReply(comment) {\n      this.$set(comment, 'showReply', !comment.showReply);\n    },\n    delComment(commentId) {\n      // 单个删除\n      this.$confirm('您确定删除吗？', '确认删除', {\n        type: \"warning\"\n      }).then(response => {\n        this.$request.delete('/comment/delete/' + commentId).then(res => {\n          if (res.code === '200') {\n            // 表示操作成功\n            this.$message.success('操作成功');\n            this.loadComment();\n          } else {\n            this.$message.error(res.msg); // 弹出错误的信息\n          }\n        });\n      }).catch(() => {});\n    },\n    loadComment() {\n      this.$request.get('/comment/selectTree/' + this.id + '/菜谱').then(res => {\n        this.commentList = res.data || [];\n      });\n      this.$request.get('/comment/selectCount/' + this.id + '/菜谱').then(res => {\n        this.commentCount = res.data || 0;\n      });\n    },\n    addComment(comment) {\n      //  comment 有值表示这是回复\n      let data = {\n        fid: this.id,\n        userId: this.user.id,\n        module: '菜谱',\n        content: this.content\n      };\n      if (comment) {\n        data.content = comment.replyContent;\n        data.pid = comment.id;\n      }\n      this.$request.post('/comment/add', data).then(res => {\n        if (res.code === '200') {\n          this.$message.success('操作成功');\n          this.content = '';\n          this.loadComment();\n        } else {\n          this.$message.error(res.msg);\n        }\n      });\n    },\n    updateCount() {\n      this.$request.put('/foods/updateCount/' + this.id).then(res => {\n        this.load();\n      });\n    },\n    collect() {\n      this.$request.post('/collect/set', {\n        fid: this.id,\n        userId: this.user.id,\n        module: '菜谱'\n      }).then(res => {\n        if (res.code === '200') {\n          this.$message.success('操作成功');\n          this.load();\n        } else {\n          this.$message.error(res.msg);\n        }\n      });\n    },\n    load() {\n      this.$request.get('/foods/selectById/' + this.id).then(res => {\n        this.foods = res.data || {};\n        this.materialList = JSON.parse(this.foods?.material || '[]');\n        this.stepList = JSON.parse(this.foods?.steps || '[]');\n        if (this.materialList.length && this.materialList.length % 2 !== 0) {\n          // this.materialList.length % 2 !== 0\n          this.materialList.push({});\n        }\n      });\n    }\n  }\n};","map":{"version":3,"names":["Footer","name","components","data","id","$route","query","foods","materialList","stepList","user","JSON","parse","localStorage","getItem","commentCount","content","commentList","created","updateCount","loadComment","methods","handleShowReply","comment","$set","showReply","delComment","commentId","$confirm","type","then","response","$request","delete","res","code","$message","success","error","msg","catch","get","addComment","fid","userId","module","replyContent","pid","post","put","load","collect","material","steps","length","push"],"sources":["src/views/front/FoodDetail.vue"],"sourcesContent":["<template>\r\n  <div class=\"main-content\" style=\"width: 50%\">\r\n    <img :src=\"foods.cover\" alt=\"\" style=\"width: 100%; border-radius: 5px\">\r\n    <div style=\"margin: 20px 0; font-size: 22px; font-weight: bold\">{{ foods.name }}</div>\r\n    <div style=\"display: flex; margin-bottom: 30px\">\r\n      <div style=\"display: flex; align-items: center; flex: 1\">\r\n        <img :src=\"foods.avatar\" alt=\"\" style=\"width: 30px; height: 30px; border-radius: 50%\">\r\n        <span style=\"margin-left: 5px\">{{ foods.userName }}</span>\r\n      </div>\r\n      <div style=\"flex: 1; display: flex; align-items: center; justify-content: flex-end\">\r\n        <span style=\"font-size: 20px; color: orange; font-weight: bold; margin-right: 2px\">{{ foods.count }}</span> 浏览\r\n        <span style=\"font-size: 20px; color: orange; font-weight: bold; margin-right: 2px; margin-left: 30px\">{{ foods.collectCount }}</span> 收藏\r\n\r\n        <el-button icon=\"el-icon-star-on\" style=\"margin-left: 30px; color: orange\" v-if=\"foods.userCollect\" @click=\"collect\">已收藏</el-button>\r\n        <el-button icon=\"el-icon-star-off\" style=\"margin-left: 30px\" v-else @click=\"collect\">收藏</el-button>\r\n      </div>\r\n    </div>\r\n\r\n    <div style=\"font-size: 14px; color: #666; line-height: 24px; margin: 30px 0\">{{ foods.descr }}</div>\r\n\r\n    <div style=\"margin: 30px 0\">\r\n      <div style=\"margin: 20px 0; font-size: 22px; font-weight: bold\">{{ foods.name }}的原料</div>\r\n      <div style=\"display: flex; flex-wrap: wrap; background-color: #e9ffe2\">\r\n        <div v-for=\"(item, index) in materialList\" :key=\"index\" style=\"display: flex; padding: 10px; width: 50%;\"\r\n             :class=\"{ 'bt' : index !== materialList.length - 1 && index !== materialList.length - 2, 'br' : index % 2 === 0 }\">\r\n          <div style=\"flex: 1\">{{ item.name }}</div>\r\n          <div>{{ item.value }}</div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n\r\n\r\n    <div style=\"margin: 30px 0\">\r\n      <div style=\"margin: 20px 0; font-size: 22px; font-weight: bold\">{{ foods.name }}的做法</div>\r\n      <div style=\"display: flex; margin-bottom: 10px\" v-for=\"(item, index) in stepList\" :key=\"index\">\r\n        <img :src=\"item.img\" style=\"width: 100px; height: 100px\">\r\n        <div style=\"padding-left: 10px\">\r\n          <div style=\"font-size: 18px; font-weight: bold; margin-bottom: 10px\">步骤 {{ index + 1 }}</div>\r\n          <div>{{ item.text }}</div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n\r\n    <div style=\"margin: 30px 0\">\r\n      <div style=\"margin: 20px 0; font-size: 22px; font-weight: bold\">{{ foods.name }}的技巧</div>\r\n      <div>{{ foods.skills }}</div>\r\n    </div>\r\n\r\n    <div style=\"margin: 30px 0; color: #666; font-size: 12px\">发布时间：{{ foods.time }}</div>\r\n\r\n    <div style=\"margin: 50px 0\">\r\n      <div style=\"margin-bottom: 20px; font-size: 22px; font-weight: bold\">评论 {{ commentCount }}</div>\r\n      <div style=\"margin-bottom: 20px\">\r\n        <el-input type=\"textarea\" placeholder=\"请输入评论\" v-model=\"content\"></el-input>\r\n        <div style=\"text-align: right; margin-top: 5px\"><el-button type=\"primary\" @click=\"addComment\">评论</el-button></div>\r\n      </div>\r\n\r\n      <div>\r\n        <div v-for=\"item in commentList\" :key=\"item.id\" style=\"margin-bottom: 20px\">\r\n          <!-- 一级评论-->\r\n          <div style=\"display: flex; margin-bottom: 20px\">\r\n            <img :src=\"item.avatar\" alt=\"\" style=\"width: 50px; height: 50px; border-radius: 50%\">\r\n            <div style=\"padding-left: 15px; flex: 1\">\r\n              <div style=\"margin-bottom: 10px; color: #666\">{{ item.userName }}</div>\r\n              <div style=\"margin-bottom: 5px\">{{ item.content }}</div>\r\n              <div style=\"color: #666; font-size: 13px; margin-bottom: 5px\">\r\n                <span>{{ item.time }}</span>\r\n                <span @click=\"handleShowReply(item)\" style=\"margin: 0 20px; cursor: pointer\"\r\n                      :class=\"{'comment-active' : item.showReply}\"><i class=\"el-icon-s-comment\"></i>评论</span>\r\n                <span @click=\"delComment(item.id)\" v-if=\"item.userId === user.id\" style=\"cursor: pointer\"><i class=\"el-icon-delete\"></i>删除</span>\r\n              </div>\r\n              <div v-if=\"item.showReply\">\r\n                <el-input type=\"textarea\" placeholder=\"请输入回复\" v-model=\"item.replyContent\"></el-input>\r\n                <div style=\"text-align: right; margin-top: 5px\"><el-button type=\"primary\" @click=\"addComment(item)\">回复</el-button></div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n          <!-- 二级评论-->\r\n          <div v-if=\"item.children\" style=\"padding-left: 65px\">\r\n            <div v-for=\"sub in item.children\" style=\"display: flex; margin-bottom: 20px\">\r\n              <img :src=\"sub.avatar\" alt=\"\" style=\"width: 50px; height: 50px; border-radius: 50%\">\r\n              <div style=\"padding-left: 15px; flex: 1\">\r\n                <div style=\"margin-bottom: 10px; color: #666\">{{ sub.userName }} <span v-if=\"sub.parentUserName !== item.userName\">回复：{{ sub.parentUserName }}</span></div>\r\n                <div style=\"margin-bottom: 5px\">{{ sub.content }}</div>\r\n                <div style=\"color: #666; font-size: 13px; margin-bottom: 5px\">\r\n                  <span>{{ sub.time }}</span>\r\n                  <span @click=\"handleShowReply(sub)\" style=\"margin: 0 20px; cursor: pointer\"\r\n                        :class=\"{'comment-active' : sub.showReply}\"><i class=\"el-icon-s-comment\"></i>评论</span>\r\n                  <span @click=\"delComment(sub.id)\" v-if=\"sub.userId === user.id\" style=\"cursor: pointer\"><i class=\"el-icon-delete\"></i>删除</span>\r\n                </div>\r\n                <div v-if=\"sub.showReply\">\r\n                  <el-input type=\"textarea\" placeholder=\"请输入回复\" v-model=\"sub.replyContent\"></el-input>\r\n                  <div style=\"text-align: right; margin-top: 5px\"><el-button type=\"primary\" @click=\"addComment(sub)\">回复</el-button></div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n\r\n    <Footer />\r\n\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport Footer from \"@/components/Footer\";\r\nexport default {\r\n  name: \"FoodDetail\",\r\n  components: {Footer},\r\n  data() {\r\n    return {\r\n      id: this.$route.query.id,  // 菜谱ID\r\n      foods: {},\r\n      materialList: [],\r\n      stepList: [],\r\n      user: JSON.parse(localStorage.getItem('xm-user') || '{}'),\r\n      commentCount: 0,\r\n      content: '',\r\n      commentList: []\r\n    }\r\n  },\r\n  created() {\r\n    this.updateCount()\r\n\r\n    this.loadComment()\r\n  },\r\n  methods: {\r\n    handleShowReply(comment) {\r\n      this.$set(comment, 'showReply', !comment.showReply)\r\n    },\r\n    delComment(commentId) {   // 单个删除\r\n      this.$confirm('您确定删除吗？', '确认删除', {type: \"warning\"}).then(response => {\r\n        this.$request.delete('/comment/delete/' + commentId).then(res => {\r\n          if (res.code === '200') {   // 表示操作成功\r\n            this.$message.success('操作成功')\r\n            this.loadComment()\r\n          } else {\r\n            this.$message.error(res.msg)  // 弹出错误的信息\r\n          }\r\n        })\r\n      }).catch(() => {\r\n      })\r\n    },\r\n    loadComment() {\r\n      this.$request.get('/comment/selectTree/' + this.id + '/菜谱').then(res => {\r\n        this.commentList = res.data || []\r\n      })\r\n\r\n      this.$request.get('/comment/selectCount/' + this.id + '/菜谱').then(res => {\r\n        this.commentCount = res.data || 0\r\n      })\r\n    },\r\n    addComment(comment) {  //  comment 有值表示这是回复\r\n      let data = { fid: this.id, userId: this.user.id, module: '菜谱', content: this.content }\r\n      if (comment) {\r\n        data.content = comment.replyContent\r\n        data.pid = comment.id\r\n      }\r\n      this.$request.post('/comment/add', data).then(res => {\r\n        if (res.code === '200') {\r\n          this.$message.success('操作成功')\r\n          this.content = ''\r\n          this.loadComment()\r\n        } else {\r\n          this.$message.error(res.msg)\r\n        }\r\n      })\r\n    },\r\n    updateCount() {\r\n      this.$request.put('/foods/updateCount/' + this.id).then(res => {\r\n        this.load()\r\n      })\r\n    },\r\n    collect() {\r\n      this.$request.post('/collect/set', { fid: this.id, userId: this.user.id, module: '菜谱' }).then(res => {\r\n        if (res.code === '200') {\r\n          this.$message.success('操作成功')\r\n          this.load()\r\n        } else {\r\n          this.$message.error(res.msg)\r\n        }\r\n      })\r\n    },\r\n    load() {\r\n      this.$request.get('/foods/selectById/' + this.id).then(res => {\r\n        this.foods = res.data || {}\r\n        this.materialList = JSON.parse(this.foods?.material || '[]')\r\n        this.stepList = JSON.parse(this.foods?.steps || '[]')\r\n        if (this.materialList.length && this.materialList.length % 2 !== 0) {   // this.materialList.length % 2 !== 0\r\n          this.materialList.push({})\r\n        }\r\n      })\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.br {\r\n  border-right: 1px solid #ccc;\r\n}\r\n\r\n.bt {\r\n  border-bottom: 1px solid #ccc;\r\n}\r\n.comment-active {\r\n  color: #2a60c9;\r\n}\r\n</style>"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}